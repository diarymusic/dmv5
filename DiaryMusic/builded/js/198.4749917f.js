"use strict";(this["webpackChunkdm"]=this["webpackChunkdm"]||[]).push([[198],{9198:function(e,t,s){s.r(t),s.d(t,{default:function(){return se}});var a=s(1624);const l=e=>((0,a.dD)("data-v-fb3cb4e8"),e=e(),(0,a.Cn)(),e),i={class:"bg-white text-black dark:text-white"},n={id:"page",class:"site"},o={class:"container"},d={class:"row justify-content-center align-items-center g-2"},c=l((()=>(0,a._)("div",{class:"col-xs-8 col-sm-10 col-md-6 col-lg-6"},[(0,a._)("div",{class:"hero"},[(0,a._)("h1",{class:"typing","data-text":"在此注册到Diary Music 官网."}," 在此注册到Diary Music 官网. "),(0,a._)("p",null,[(0,a.Uk)("如果您已拥有账号,您可"),(0,a._)("a",{href:"#/login"},"在此登录"),(0,a.Uk)(".")])])],-1))),p={class:"col-xs-8 col-sm-10 col-md-6 col-lg-6"},u={class:"login"},m={class:"main text-black"},h={key:0,class:"side-icon"},g={class:"mb-3"},v=l((()=>(0,a._)("span",{class:"text-2xl"},"你的邮箱为：",-1))),f={class:"row justify-content-center align-items-center"},b={class:"col-12"},y=["value"],_={class:"row justify-content-center align-items-center"},w={class:"col-8",id:"vfi"},k={class:"col-4",id:"vfb"},x=l((()=>(0,a._)("span",{class:"spinner-border spinner-border-sm d-none",role:"status","aria-hidden":"true",id:"vfsp"},null,-1))),j={class:"side-icon"},C=l((()=>(0,a._)("i",{class:"ri-account-box-line"},null,-1))),S={class:"side-icon"},T=l((()=>(0,a._)("i",{class:"ri-mail-line"},null,-1))),U={class:"side-icon"},D={class:"row justify-content-center align-items-center g-2 avaUpl"},I={class:"col-12 c10"},V=l((()=>(0,a._)("i",{class:"ri-image-add-fill"},null,-1))),q={class:"side-icon"},O={class:"side-icon"},P=l((()=>(0,a._)("i",{class:"ri-eye-off-line"},null,-1))),A=l((()=>(0,a._)("span",{class:"spinner-border spinner-border-sm d-none",role:"status","aria-hidden":"true",id:"rsp"},null,-1))),L=l((()=>(0,a._)("span",{class:"spinner-border spinner-border-sm d-none",role:"status","aria-hidden":"true",id:"rsp"},null,-1))),M=l((()=>(0,a._)("button",{type:"button",class:"prvLnch hidden","data-bs-toggle":"modal","data-bs-target":"#PrvModal"},null,-1))),F={class:"modal fade",id:"PrvModal",tabindex:"-1","data-bs-backdrop":"static","data-bs-keyboard":"false",role:"dialog","aria-labelledby":"modalTitleId","aria-hidden":"true"},H={class:"modal-dialog modal-dialog-scrollable modal-dialog-centered modal-sm",role:"document"},R={class:"modal-content shadow-lg"},Y=l((()=>(0,a._)("div",{class:"modal-header"},[(0,a._)("h5",{class:"modal-title",id:"modalTitleId"},"上传头像"),(0,a._)("button",{type:"button",class:"btn-close prvCls","data-bs-dismiss":"modal","aria-label":"Close"})],-1))),z={class:"modal-body flex flex-row justify-center align-center"},E=["src"],Z={class:"modal-footer"},$=l((()=>(0,a._)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 取消上传 ",-1)));function B(e,t,s,l,r,B){return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("div",i,[(0,a._)("div",n,[(0,a._)("div",o,[(0,a._)("div",d,[c,(0,a._)("div",p,[(0,a._)("div",u,[(0,a._)("div",m,[(0,a._)("form",null,[r.verify?((0,a.wg)(),(0,a.iD)("div",h,[(0,a._)("div",g,[v,(0,a._)("span",null,(0,a.zw)(r.lockem),1)]),(0,a._)("div",f,[(0,a._)("div",b,[(0,a._)("input",{value:r.lockem,disabled:"disabled"},null,8,y)])]),(0,a._)("div",_,[(0,a._)("div",w,[(0,a.wy)((0,a._)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>r.vf=e),placeholder:"验证码",required:"",type:"number"},null,512),[[a.nr,r.vf]])]),(0,a._)("div",k,[(0,a._)("button",{type:"button",class:"send",onClick:t[1]||(t[1]=(...e)=>B.sendVerf&&B.sendVerf(...e))},[x,(0,a.Uk)(" 发送 ")])])])])):((0,a.wg)(),(0,a.iD)(a.HY,{key:1},[(0,a._)("div",j,[(0,a.wy)((0,a._)("input",{type:"text",name:"un",placeholder:"您的用户名","onUpdate:modelValue":t[2]||(t[2]=e=>r.un=e),required:""},null,512),[[a.nr,r.un]]),C]),(0,a._)("div",S,[(0,a.wy)((0,a._)("input",{type:"email",name:"ue",placeholder:"您的邮箱","onUpdate:modelValue":t[3]||(t[3]=e=>r.em=e),required:""},null,512),[[a.nr,r.em]]),T]),(0,a._)("div",U,[(0,a._)("div",D,[(0,a._)("div",I,[(0,a._)("input",{class:"form-control",type:"file",id:"fileAjax",name:"fileAjax",placeholder:"上传一个头像",style:{height:"100%"},accept:".jpg,.png,.jpeg,.gif",required:"",onChange:t[4]||(t[4]=(...e)=>B.showPrv&&B.showPrv(...e))},null,32),V])])]),(0,a._)("div",q,[(0,a.wy)((0,a._)("input",{id:"",type:"password",name:"pw",placeholder:"您的密码",required:"","onUpdate:modelValue":t[5]||(t[5]=e=>r.pw=e)},null,512),[[a.nr,r.pw]]),(0,a._)("i",{class:"ri-eye-off-line",id:"eye",onClick:t[6]||(t[6]=(...e)=>B.eyeOnOff&&B.eyeOnOff(...e))})]),(0,a._)("div",O,[(0,a.wy)((0,a._)("input",{type:"password",id:"repsw",name:"repsw",placeholder:"重复密码",required:"","onUpdate:modelValue":t[7]||(t[7]=e=>r.pww=e)},null,512),[[a.nr,r.pww]]),P])],64)),(0,a._)("div",null,[r.verify?((0,a.wg)(),(0,a.iD)("button",{key:0,type:"button",class:"submit",onClick:t[8]||(t[8]=(...e)=>B.verificate&&B.verificate(...e))},[A,(0,a.Uk)(" 验证 ")])):((0,a.wg)(),(0,a.iD)("button",{key:1,type:"button",class:"submit",onClick:t[9]||(t[9]=(...e)=>B.regi&&B.regi(...e))},[L,(0,a.Uk)(" 注册 ")]))])])])])])])])])]),M,(0,a._)("div",F,[(0,a._)("div",H,[(0,a._)("div",R,[Y,(0,a._)("div",z,[(0,a._)("img",{class:"w-50 h-50",src:r.imgTemp,alt:""},null,8,E)]),(0,a._)("div",Z,[$,(0,a._)("button",{type:"button",class:"btn btn-primary",onClick:t[10]||(t[10]=(...e)=>B.uplImg&&B.uplImg(...e))},"上传")])])])])],64)}var G=s(3570),J=s.n(G),K=s(5092),N=s.n(K);const Q='<div class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false">\n                            <div class="toast-header">\n                                <img src="" class="rounded me-2" alt="">\n                                <strong class="me-auto">{{msg}}</strong>\n                                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>\n                            </div>\n                        </div>';function W(){var e=[].slice.call(document.querySelectorAll(".toast")),t=e.map((function(e){return new bootstrap.Toast(e)}));t[t.length-1].show()}var X={data(){return{flag:!1,lockem:"",un:"",em:"",pw:"",pww:"",vf:"",img:"default.png",imgTemp:"default.png",verify:!1}},methods:{eyeOnOff(){this.flag?(J()("#eyeInput").attr("type","password"),J()("#eye").attr("class","ri-eye-off-line"),this.flag=!1):(J()("#eyeInput").attr("type","text"),J()("#eye").attr("class","ri-eye-line"),this.flag=!0)},sendVerf(){null!==this.lockem&&fetch(`/api/sendCode/${this.lockem}`).then((e=>e.json())).then((e=>{let t={msg:"发送失败"};t.msg=200==e.status?"发送成功":"发送失败",J()(N().compile(Q)(t).toString()).appendTo(".toast-container"),W()}))},verificate(){let e=new FormData;e.append("em",this.lockem),e.append("vf",this.vf),new Promise(((t,s)=>{""==this.lockem?t(2):""==!this.vf?fetch("/api/verify",{method:"post",body:e}).then((e=>e.json())).then((e=>{200===e.status&&0===e.code?(location.hash="#/",t(0)):t(1)})).catch((e=>{t(4)})):t(3)})).then((e=>{var t="";switch(e){case 0:t="验证成功";break;case 1:t="验证失败:请检查验证码是否正确";break;case 2:t="验证失败:请返回注册";break;case 3:t="验证失败:验证码不能为空";break;case 4:t="验证失败:系统错误";break;default:t="验证失败:系统错误";break}J()(N().compile(Q)({msg:t}).toString()).appendTo(".toast-container"),W()}))},regi(){if(console.log("test"),this.lockem=this.em,""!==this.un.toString()&&""!==this.em.toString()&&""!==this.pw.toString()&&""!==this.pww.toString()&&this.pww.toString()===this.pw.toString()){let e=new FormData;e.append("un",this.un),e.append("em",this.em),e.append("pw",b64_sha256(this.pw)),e.append("ap",this.img),fetch("/api/register",{method:"post",body:e}).then((e=>e.json())).then((e=>{localStorage.setItem("token",e.token),200==e.status&&0==e.code&&(this.verify=!0),J()(N().compile(Q)({msg:""+(200==e.status?"注册成功: 需要下一步验证":"注册失败: "+(1==e.code?"系统错误":2==e.code?"邮箱已存在":3==e.code?"用户名已存在":""))}).toString()).appendTo(".toast-container"),W()})).catch((e=>{J()(N().compile(Q)({msg:"注册失败: "+(1==r.code?"系统错误":2==r.code?"邮箱已存在":3==r.code?"用户名已存在":"")}).toString()).appendTo(".toast-container"),W(),console.error(e)}))}else J()(N().compile(Q)({msg:"注册失败，请检查是否正确填写信息"}).toString()).appendTo(".toast-container"),W()},showPrv(){var e=new FileReader;e.readAsDataURL(J()("#fileAjax").prop("files")[0]),e.onload=()=>{try{this.imgTemp=e.result,J()(".prvLnch").click(),console.log(e.result)}catch(t){}},e.addEventListener("abort error",(()=>{}))},uplImg(){this.img=this.imgTemp,J()(".prvCls").click()}},created(){},mounted(){fetch("/api/getUserInfo",{headers:{Token:localStorage.token}}).then((e=>e.json())).then((e=>{200==e.status&&0==e.verified&&(this.lockem=e.data.acc,this.verify=!0)}))}},ee=s(8998);const te=(0,ee.Z)(X,[["render",B],["__scopeId","data-v-fb3cb4e8"]]);var se=te}}]);
//# sourceMappingURL=198.4749917f.js.map