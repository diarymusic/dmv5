"use strict";(this["webpackChunkdm"]=this["webpackChunkdm"]||[]).push([[684],{4371:function(e,t,s){s.d(t,{Z:function(){return y}});var a=s(1624);const r={class:"audio-player text-black"},i={class:"audio-info"},n={class:"song-name"},o={class:"controlsrow"},l={class:"controls"},d=["id"];function u(e,t,s,u,c,g){return(0,a.wg)(),(0,a.iD)("div",r,[(0,a._)("div",i,[(0,a._)("div",n,(0,a.zw)(s.songName),1),(0,a._)("div",o,[(0,a._)("div",l,[(0,a._)("button",{class:"play-pause",onClick:t[0]||(t[0]=(...e)=>g.togglePlay&&g.togglePlay(...e))},[(0,a._)("i",{class:(0,a.C_)(["text-black playAndPause",c.isPlaying?"ri-pause-fill":"ri-play-fill"])},null,2)])]),(0,a._)("div",{class:"progress-bar",id:"bar"+s.songid,onMousedown:t[2]||(t[2]=(...e)=>g.startDrag&&g.startDrag(...e)),onClick:t[3]||(t[3]=(...e)=>g.handleClick&&g.handleClick(...e))},[(0,a._)("div",{class:"progress",style:(0,a.j5)({width:c.progress+"%"})},null,4),(0,a._)("div",{class:"progress-handle",style:(0,a.j5)({left:c.progress+"%"}),onMousedown:t[1]||(t[1]=(...e)=>g.startDrag&&g.startDrag(...e))},null,36)],40,d)])])])}s(560),s(4224),s(1121),s(7133);var c=[];function g({songname:e,src:t}){var s=new Audio(t);return c.push({songname:e,src:s}),console.log("Current Audios : %d",c.length),s}function h(e){document.querySelectorAll(".playAndPause").forEach((e=>{e.classList.remove("ri-pause-fill"),e.classList.add("ri-play-fill")})),c.forEach((function(t){t.src!=e&&t.src.pause()}))}function v(){var e=null;c.forEach((t=>{e=t.src.isPlaying?null:t.src}));var t=new(window.AudioContext||window.webkitAudioContext),s=t.createAnalyser(),a=t.createMediaElementSource(e);a.connect(s),s.connect(t.destination);var r=document.getElementById("frequencySpectrum"),i=r.getContext("2d");s.fftSize=2048;var n=s.frequencyBinCount,o=new Uint8Array(n);function l(){requestAnimationFrame(l),s.getByteFrequencyData(o),i.fillStyle="rgb(0, 0, 0)",i.fillRect(0,0,r.width,r.height);for(var e,t=r.width/n*2.5,a=0,d=0;d<n;d++)e=o[d],i.fillStyle=`rgb(${e+100},${e+100},${e+100})`,i.fillRect(a,r.height-e/2,t,e/2),a+=t+1}l()}var m={data(){return{audio:null,isPlaying:!1,progress:0,dragStartX:0,dragStartProgress:0}},props:{songName:{type:String,required:!0},songPath:{type:String,required:!0},songid:{type:Number,required:!0},songArts:{type:Array,required:!0}},mounted(){console.log(this.songName),this.audio=g({songname:this.songName,src:this.songPath}),this.audio.addEventListener("timeupdate",this.updateProgress),this.audio.addEventListener("ended",this.resetPlayer)},methods:{togglePlay(){this.isPlaying?this.audio.pause():(h(this.audio),v(),this.audio.play()),this.isPlaying=!this.isPlaying},updateProgress(){const{currentTime:e,duration:t}=this.audio;this.progress=e/t*100},startDrag(e){this.dragStartX=e.clientX,this.dragStartProgress=this.progress,document.addEventListener("mousemove",this.handleDrag),document.addEventListener("mouseup",this.stopDrag)},startBarDrag(e){this.dragStartX=e.clientX,this.dragStartProgress=this.progress,document.addEventListener("mousemove",this.handleBar),document.addEventListener("mouseup",this.stopBarDrag)},handleDrag(e){const t=e.clientX-this.dragStartX,s=document.getElementById(`bar${this.songid}`).offsetWidth,a=t/s*100;this.progress=this.dragStartProgress+a,this.audio.currentTime=this.progress/100*this.audio.duration},handleBar(e){const t=document.getElementById(`bar${this.songid}`).offsetWidth,s=e.target.getBoundingClientRect().left,a=s/t*100;this.progress=a,this.audio.currentTime=a/100*this.audio.duration},handleClick(e){const t=document.getElementById(`bar${this.songid}`).offsetWidth,s=e.clientX-e.target.getBoundingClientRect().left,a=s/t*100;this.progress=a,this.audio.currentTime=a/100*this.audio.duration},stopDrag(){document.removeEventListener("mousemove",this.handleDrag),document.removeEventListener("mouseup",this.stopDrag)},stopBarDrag(){document.removeEventListener("mousemove",this.handleDrag),document.removeEventListener("mouseup",this.stopDrag)},resetPlayer(){this.isPlaying=!1,this.progress=0,this.audio.currentTime=0}}},p=s(8998);const f=(0,p.Z)(m,[["render",u],["__scopeId","data-v-45fed9f8"]]);var y=f},5869:function(e,t,s){s.r(t),s.d(t,{default:function(){return P}});s(560);var a=s(1624),r=s(4371);const i={class:"w-screen px-6 sm:px-8 lg:flex lg:w-full lg:items-center lg:justify-between lg:gap-12"},n={class:"relative overflow-hidden lg:w-1/2 image-container-r2l"},o=["src"],l=(0,a._)("div",{class:"mask-r2l"},null,-1),d={class:"relative overflow-y-scroll lg:w-1/2"},u=(0,a._)("div",{class:"h-8 lg:h-1"},null,-1),c={class:"font-display font-extrabold pb-2 text-center lg:text-left"},g={class:"text-white-300 text-6xl xl:text-7xl"},h=(0,a._)("div",null,[(0,a._)("div",{class:"h-3"})],-1),v=(0,a._)("div",{class:"h-3"},null,-1),m={class:"font-display text-lg xl:text-xl font-extrabold text-black dark:text-orange-100 leading-4 text-center lg:text-left"},p=["href","data-trueid"],f=(0,a._)("div",{class:"h-4"},null,-1),y={class:"text-base text-black dark:text-gray-300 text-center lg:text-left",style:{"white-space":"pre-wrap"}},w={class:"h-12"},_={class:"xl: flex flex-col gap-4 xl:flex-row justify-center mb-4"},x=(0,a._)("canvas",{id:"frequencySpectrum"},null,-1);var D={__name:"songDetail",props:["sid"],setup(e){const t=(0,a.iH)({}),s=(0,a.iH)({}),D=(0,a.iH)({}),b=(0,a.iH)({}),P=e;return(0,a.bv)((()=>{var e=P.sid;fetch("/api/get163",{headers:{"Content-Type":"application/json;charset=utf8","Access-Control-Allow-Origin":"*"}}).then((e=>e.json())).then((a=>{s.value={name:"",cover:"",artists:{name:"",trueid:""},desc:"",audioshow:!1,audios:[]},b.value=(a.status=200)&&void 0!=a.data?a.data:{},t.value={cover:b.value[e].cover,songname:b.value[e].name,artists:b.value[e].artists,audioshow:!1,audios:[]},t.value.desc="加载中···",fetch(`/api/getAlbum/${b.value[e].trueid}`).then((e=>e.json())).then((s=>{t.value={cover:b.value[e].cover,songname:b.value[e].name,artists:b.value[e].artists,audioshow:!1,audios:[]},D.value=1==s.resourceState?s:{},t.value.desc=1==s.resourceState?s.album.description:"__//\n获取失败，请稍后再试···\n- Diary Music -\n//__";for(let e=0;e<s.songs.length;e++){t.value.audioshow=!0;let a=[];for(let t=0;t<s.songs[e].ar.length;t++)a.push({n:s.songs[e].ar[t].name,i:s.songs[e].ar[t].id});t.value.audios.push({name:`#${e+1}: ${s.songs[e].name}`,artists:a,src:`/api/getMp3/${s.songs[e].id}`})}}))})).catch((e=>t.value.desc=`__//\n获取失败，请稍后再试···\n错误代码：${e}\n- Diary Music -\n//__`))})),(e,s)=>((0,a.wg)(),(0,a.iD)("section",i,[(0,a._)("div",n,[(0,a._)("img",{src:t.value.cover,class:"image"},null,8,o),l]),(0,a._)("div",d,[u,(0,a._)("h2",c,[(0,a._)("span",g,(0,a.zw)(t.value.songname),1),h]),v,(0,a._)("h3",m,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.value.artists,((e,s)=>((0,a.wg)(),(0,a.iD)(a.HY,{key:s},[(0,a._)("a",{class:"artistlink",href:"https://music.163.com/#/artist?id="+e.trueid,"data-trueid":e.trueid},(0,a.zw)(e.name),9,p),(0,a.Uk)((0,a.zw)(s+1!=t.value.artists.length?" / ":""),1)],64)))),128))]),f,(0,a._)("p",y,(0,a.zw)(t.value.desc),1),(0,a._)("div",w,[(0,a._)("div",_,[t.value.audioshow?((0,a.wg)(),(0,a.iD)(a.HY,{key:0},[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.value.audios,((e,t)=>((0,a.wg)(),(0,a.j4)((0,a.LL)(r.Z),{key:t,songName:e.name,songPath:e.src,songid:t,songArts:e.artists},null,8,["songName","songPath","songid","songArts"])))),128)),x],64)):(0,a.kq)("",!0)])])])]))}};const b=D;var P=b}}]);
//# sourceMappingURL=684.6c422da4.js.map