<template>
  <div class="bg-white dark:bg-black">
    <!-- <section class="lg:mb-10 lg:w-1/2  px-6 sm:px-8 lg:flex lg:items-center lg:justify-between lg:gap-12"> -->
    <div class="main">
      <div class="h-20 md:h-20 sm:h-40 lg:h-10 mh-30"></div>
      <div class="h-[30vh]"></div>
<!--      <section
        class="w-screen flex items-center justify-center px-6 sm:px-8 lg:flex lg:w-full lg:items-center lg:justify-between lg:gap-12">
        <div class="lg:mx-auto lg:max-w-2xl">
          &lt;!&ndash; <div class="h-20"></div> &ndash;&gt;
          <h2 class="font-display font-extrabold text-black dark:text-white pb-2 text-7xl xl:text-8xl text-center lg:text-left">
            <span class="text-gradient">Diary Music</span>
          </h2>
          <div class="h-3"></div>
          <h3
            class="font-display text-2xl lg:text-3xl xl:text-4xl font-extrabold text-black dark:text-white leading-4 text-center lg:text-left">
&lt;!&ndash;            <span class="text-green-200">一周年</span>专辑征稿启事&ndash;&gt;
            <div class="h-3"></div>
&lt;!&ndash;            <span class="text-yellow-200">捕梦网</span>EP&ndash;&gt;
          </h3>
          <div class="h-4"></div>
&lt;!&ndash;          <p class="text-md lg:text-lg xl:text-xl  text-black dark:text-gray-300 text-center lg:text-left">            收录方向：All Style<br>            征稿时间：2023年6月19日 - 2024年1月8日<br>        发行时间：2024年1月19日<br>          发行区域：全球<br>
      We're waiting for you...
</p>&ndash;&gt;
          <div class="h-9 xl:h-10"></div>
          <div class="xl: flex flex-col gap-4 xl:flex-row justify-center">
            <a class="inline-flex items-center justify-center xl:text-xl h-14 xl:h-16 box-border px-8 rounded focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-transparent font-semibold bg-blue-600 text-white dark:text-white hover:bg-blue-500 dark:focus:ring-blue-200 transition-colors duration-200 w-full xl:w-60"
              href="https://www.beatarray.com/label/DiaryMusic">立即投稿</a>
            <a class="inline-flex items-center justify-center xl:text-xl h-14 xl:h-16 box-border px-8 rounded bg-transparent text-black border-current dark:hover:border-blue-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-transparent dark:focus:ring-blue-200 focus:ring-opacity-80 font-semibold border-2 w-full xl:w-60"
              href="https://music.163.com/#/user/home?id=7835153373">网易云主页</a>
          </div>
        </div>
        &lt;!&ndash; 超级big图片 &ndash;&gt;
        <div class="relative overflow-hidden lg:w-1/2 image-container-l2r hidden lg:block">
&lt;!&ndash;          <img src="uploads/song/cover/0010.png" class="image smoove" loading="lazy">&ndash;&gt;
          &lt;!&ndash; <img src="/uploads/song/lijiebighead.jpg" class="image"> &ndash;&gt;
          敬请期待···
          <div class="mask-l2r mask-b2t"></div>
        </div>
      </section>-->

      <div class="h-[30vh]"></div>

      <section class="w-screen px-6 sm:px-8 lg:flex lg:w-full lg:items-center lg:justify-between lg:gap-12">
        <div class="h-20 lg:h-1"></div>

        <div class="lg:mx-auto lg:max-w-2xl">
          <div class="h-8 lg:h-1"></div>
          <h2 class="font-display font-extrabold  pb-2  text-center lg:text-left">
            <span class="text-black dark:text-purple-300 text-6xl xl:text-7xl">关于我们</span>
          </h2>
          <div class="h-3"></div>
          <h2 class="font-display font-extrabold  pb-2  text-center lg:text-left">
            <span class="text-black dark:text-purple-100">ABOUT US</span>
          </h2>

          <div class="h-4"></div>
          <p class="text-base max-w-2xl text-black dark:text-gray-300 text-center lg:text-left">
            我们是来自中国的新兴电子音乐厂牌，于2023.1.19成立，目前已完成厂牌初步建设，拥有完善的审核、宣发、美工制作等资源，为您带来流畅舒适的投稿/发行体验。 </p>
          <div class="h-8"></div>
          <div class="xl: flex flex-col gap-4 xl:flex-row justify-center">
            <a class="inline-flex items-center justify-center xl:text-xl h-14 xl:h-16 box-border px-8 rounded focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-transparent font-semibold bg-blue-600 text-white dark:text-white hover:bg-blue-500 dark:focus:ring-blue-200 transition-colors duration-200 w-full xl:w-60"
              href="https://www.beatarray.com/label/DiaryMusic">立即投稿</a>
            <a class="inline-flex items-center justify-center xl:text-xl h-14 xl:h-16 box-border px-8 rounded bg-transparent text-black border-current dark:hover:border-blue-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-transparent dark:focus:ring-blue-200 focus:ring-opacity-80 font-semibold border-2 w-full xl:w-60"
              href="https://music.163.com/#/user/home?id=7835153373">网易云主页</a>
          </div>
        </div>
        <div class="relative overflow-hidden lg:w-1/2 image-container-r2l">
          <img src="https://www.beatarray.com/uploads/1680796613139-PicsArt_04-06-11.56.46.jpg" class="image smoove"
            loading="lazy">
        </div>
      </section>

      <div class="h-[30vh]"></div>

      <section class="w-screen px-6 sm:px-8 lg:flex lg:w-full lg:items-center lg:justify-between lg:gap-12">
        <div class="h-20 lg:h-1"></div>

        <div class="lg:mx-auto lg:max-w-2xl">
          <div class="h-8 lg:h-1"></div>
          <h2 class="font-display font-extrabold  pb-2  text-center">
            <span class="text-black dark:text-gray-300 text-6xl xl:text-7xl">已发行专辑</span>
          </h2>
          <div class="h-3"></div>
          <h2 class="font-display font-extrabold  pb-2  text-center">
            <span class="text-black dark:text-gray-100">RELEASED</span>
          </h2>
        </div>
        <div class="lg:h-0 h-3"></div>

        <!-- 又臭又长的列表 -->
        <div class="max-w-max flex gap-6 overflow-x-scroll pb-4 glry" @mouseenter="lockscr(0)" @mouseleave="lockscr(1)">
          <template v-for="(data,index) in songs" :key="data.id">
            <figure class="shrink-0 rounded-lg border bg-white dark:bg-gray-800 text-white gl-source fig" :data-song-id="data.id">
              <div class="items-center text-center">
                <div class="top-0">
                  <div><a :href="'#/song/'+index"><img class="rounded-lg lg:h-72 h-64 songcover"
                        :src="data.cover" loading="lazy"></a>
                  </div>
                </div>
                <div class="h-4"></div>
                <div class="text-black dark:text-white font-bold text-xl max-w-[256px] lg:max-w-[288px] truncate"><a :href="data.link"
                    class="songname">{{data.name}}</a></div>
                <div class="bottom p-16px">
                  <div class="progress-container">
                    <div class="text-black dark:text-gray-300 text-xs max-w-[256px] lg:max-w-[288px] truncate">
                      <template v-for="artist in data.artists" :key="artist.id">
                        <a class="artistlink" :href="'https://music.163.com/#/artist?id='+artist.trueid"
                          :data-trueid="artist.trueid">
                          {{artist.name}}
                        </a>
                        <span>{{index+1 != data.artists.length?' / ':''}}</span>
                      </template>
                    </div>
                    <!-- <div class="bar">
                                    <div class="progress" style="width: 60%;"></div>
                                </div> -->
                  </div>
                </div>
              </div>
            </figure>
          </template>
        </div>

      </section>

      <div class="h-[30vh]"></div>

      <section class="w-screen px-6 sm:px-8 lg:flex lg:w-full lg:items-center lg:justify-between lg:gap-12"
        id="newsongSec">
        <div class="relative overflow-hidden lg:w-1/2 image-container-r2l">
          <img :src="newsong.cover" class="image">
          <div class="mask-r2l"></div>
        </div>
        <div class="relative overflow-hidden lg:w-1/2">
          <div class="h-8 lg:h-1"></div>
          <h2 class="font-display font-extrabold  pb-2  text-center lg:text-left">
            <span class="text-black dark:text-orange-300 text-6xl xl:text-7xl">{{newsong.name}}</span>
            <div>
              <div class="h-3"></div>
              <span class="text-black dark:text-orange-100">新曲发布</span>
            </div>
          </h2>
          <div class="h-3"></div>
          <h3 class="font-display text-lg xl:text-xl font-extrabold text-black dark:text-orange-100 leading-4 text-center lg:text-left">
            <template v-for="(artist, index) in newsong.artists" :key="index">
              <a :href="'https://music.163.com/#/artist?id='+artist.trueid">{{artist.name}}</a><span>{{index+1 !=
                newsong.artists.length?' / ':''}}</span>
            </template>
          </h3>
          <div class="h-4"></div>
          <p class="text-base text-black text-center lg:text-left" style="height:25%;white-space: pre-wrap;">
            {{newsong.desc}}</p>
          <div class="h-8"></div>
          <div class="xl: flex flex-col gap-4 xl:flex-row text-white">
            <template v-if="newsong.audioshow" v-for="(au, i) in newsong.audios" :key="i">
              <!-- <audio controls :src="au.src"></audio> -->
              <component :is='player' :songName="au.songname" :songPath="au.src" :songid="i" :songArts="au.artists">
              </component>
            </template>
          </div>
        </div>
      </section>

      <div class="h-[30vh]"></div>

      <section class="w-screen px-6 sm:px-8 lg:flex lg:w-full lg:items-center lg:justify-between lg:gap-12">
        <div class="h-20 lg:h-1"></div>

        <div class="lg:mx-auto lg:max-w-2xl">
          <div class="h-8 lg:h-1"></div>
          <h2 class="font-display font-extrabold  pb-2  text-center lg:text-left">
            <span class="text-black dark:text-blue-300 text-6xl xl:text-7xl">宣发能力</span>
          </h2>
          <div class="h-3"></div>
          <h2 class="font-display font-extrabold  pb-2  text-center lg:text-left">
            <span class="text-black dark:text-blue-100">PROPAGANDA</span>
          </h2>
          <p class="text-base text-black dark:text-gray-300 text-center lg:text-left">
            我们由尘音文化担任发行工作，我们可上架全球150+音乐平台，国内流媒体平台发行速度最快可达8小时上下；<br><br>
            我们也正同时竭尽努力完善我们的宣发工作，截止目前，我们已有多个作品登上网易云官方国电周榜，并同时也有多个作品登上网易云平台其他达人所创建的歌单中，也同时有作品登上QQ音乐官方电音榜歌单，厂牌也同时会为制作人的作品提供QQ音乐Banner宣传服务。
          </p>
          <div class="h-8"></div>
          <!-- <embed src="/svg/chening.svg" type="" class="fill-blue-500"/> -->
        </div>
      </section>

      <div class="h-[30vh]"></div>

      <section class="w-screen px-6 sm:px-8 lg:flex lg:w-full lg:items-center lg:justify-between lg:gap-12">
        <div class="h-20 lg:h-1"></div>

        <div class="lg:mx-auto lg:max-w-2xl">
          <div class="h-8 lg:h-1"></div>
          <h2 class="font-display font-extrabold  pb-2  text-center lg:text-left">
            <span class="text-black dark:text-pink-300 text-6xl xl:text-7xl">视觉设计</span>
          </h2>
          <div class="h-3"></div>
          <h2 class="font-display font-extrabold  pb-2  text-center lg:text-left">
            <span class="text-black dark:text-pink-100">VISUAL DESIGN</span>
          </h2>
          <p class="text-base text-black dark:text-gray-300 text-center lg:text-left">
            *我们建立了自己的图库<br><br>

            在2023年8月11日后，我们放弃使用Unsplash等无版权图网站的图片，取而代之的是采用Diary
            Music原创图库图片，这意味着您的专辑封面将真正意义上的做到独一无二。您可自主选择图库中存在的图片，也可通过填写相关信息来得到自己心目中的图片。<br>
            <!-- *以下是我们的部分原创图；点击可查看大图 -->
          </p>
          <div class="h-8"></div>
          <!-- <embed src="/svg/chening.svg" type="" class="fill-blue-500"/> -->
        </div>

      </section>

      <div class="h-[30vh]"></div>

      <section class="w-screen px-6 sm:px-8 lg:flex lg:w-full lg:items-center lg:justify-between lg:gap-12">
        <div class="h-20 lg:h-1"></div>

        <div class="lg:mx-auto lg:max-w-2xl">
          <div class="h-8 lg:h-1"></div>
          <h2 class="font-display font-extrabold  pb-2  text-center lg:text-left">
            <span class="text-black dark:text-red-300 text-6xl xl:text-7xl">我们的成就</span>
          </h2>
          <div class="h-3"></div>
          <h2 class="font-display font-extrabold  pb-2  text-center lg:text-left">
            <span class="text-black dark:text-red-100">ACHIEVEMENTS</span>
          </h2>
          <p class="text-base max-w-2xl text-gray-300 text-center lg:text-left">
          <div class="h-4"></div>
          <div class="mx-auto">
            <ul class="text-black dark:text-gray-300 text-center lg:text-left">
              <li>
                <strong>
                  《210》登陆QQ音乐第13周喜力电音榜
                </strong>
              </li>
              <li>
                <strong>
                  《Take Away》2023年4月7日登陆网易云国电榜
                </strong>
              </li>
              <li>
                <strong>
                  《Hypaegnosis》2023年4月28日登陆网易云国电榜
                </strong>
              </li>
              <li>
                <strong>
                  《Sunset》2023年6月2日登陆网易云国电榜；登录QQ音乐第23周电音榜
                </strong>
              </li>

            </ul>
          </div>
          </p>
          <div class="h-8"></div>
        </div>
      </section>
      <div class="h-[30vh]"></div>


    </div>
    <!-- Modal -->
    <div class="modal fade " id="PlayerModal" tabindex="-1" role="dialog" aria-labelledby="modalTitleId"
      aria-hidden="true">
      <div class="modal-dialog modal-sm modal-fullscreen" role="document">
        <div class="modal-content bg-black text-white">
          <div class="modal-header">
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">&times;</button>
          </div>
          <div class="modal-body d-flex align-content-center" style="overflow-y: scroll;">
            <section class="w-screen px-6 sm:px-8 lg:flex lg:w-full lg:items-center lg:justify-between lg:gap-12">
              <div class="relative overflow-hidden lg:w-1/2 image-container-r2l">
                <img :src="modal.cover" class="image">
                <div class="mask-r2l"></div>
              </div>
              <div class="relative overflow-y-scroll lg:w-1/2">
                <div class="h-8 lg:h-1"></div>
                <h2 class="font-display font-extrabold  pb-2  text-center lg:text-left">
                  <span class="text-white-300 text-6xl xl:text-7xl">{{modal.songname}}</span>
                  <div>
                    <div class="h-3"></div>
                  </div>
                </h2>
                <div class="h-3"></div>
                <h3
                  class="font-display text-lg xl:text-xl font-extrabold text-orange-100 leading-4 text-center lg:text-left">
                  <template v-for="(artist, index) in modal.artists" :key="index">
                    <a class="artistlink" :href="'https://music.163.com/#/artist?id='+artist.trueid"
                      :data-trueid="artist.trueid">
                      {{artist.name}}
                    </a>{{index+1 != modal.artists.length?' / ':''}}
                  </template>
                </h3>
                <div class="h-4"></div>
                <p class="text-base text-gray-300 text-center lg:text-left" style="white-space: pre-wrap;">
                  {{modal.desc}}</p>
                <!-- <div class="mask-l2r mask-b2t"></div> -->
                <div class="h-12">
                  <div class="xl: flex flex-col gap-4 xl:flex-row justify-center mb-4">
                    <template v-if="modal.audioshow" v-for="(au, i) in modal.audios">
                      <!-- <audio controls :src="au.src"></audio> -->
                      <component :is='player' :songName="au.name" :songPath="au.src" :songid="i" :songArts="au.artists">
                      </component>
                    </template>
                    <canvas id="frequencySpectrum"></canvas>
                  </div>
                </div>
              </div>
            </section>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="ImgModal" tabindex="-1" role="dialog" aria-labelledby="modalTitleId" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalTitleId">Modal title</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="container-fluid">
              Add rows here
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary">Save</button>
          </div>
        </div>
      </div>
    </div>

    <!-- body -->
  </div>
</template>
<style scoped>
    @tailwind base;
  @tailwind components;
  @tailwind utilities;
    .glry::-webkit-scrollbar{
      display:none
    }
</style>
<script setup>
  import $ from 'jquery'
  import player from '@/components/musicPlayer.vue'
  import {ref,onMounted} from "vue";
  var scroll_width = 100;  // 设置每次滚动的长度，单位 px
  var scroll_events = "mousewheel DOMMouseScroll MozMousePixelScroll";
  const songs = ref({});
  const desc = ref("");
  const modal = ref({
    songname: '',
    desc: ''
  });
  const temp = ref({});
  const newsong = ref({
    songname: '',
    cover: '',
    artists: {
      name: '',
      trueid: '',
    },
    desc: '',
    audioshow: false,
    audios: []
  });
  const curr = ref(0);
  function lockscr(t){
    if (t == 0) { //禁止滚动
      document.body.style = "overflow:hidden";
      document.body.addEventListener('touchmove', this.bodyScroll, { passive: false });
    } else if (t == 1) { //开启滚动
      document.body.style = "";
      document.body.removeEventListener('touchmove', this.bodyScroll, { passive: false });
      window.onmousewheel = function () {
        return true;
      }
    }
  }
  function glryClear() {
    modal.value = {};
    temp.value = {};
  }
  function glryUpdate(i) {
    if (i === 0) {
      document.querySelector("#newsongSec").scrollIntoView({
        block: 'end',
        behavior: 'smooth'
      });
    } else {
      if (curr.value !== i) {
        modal.value = {
          cover: songs.value[i].cover,
          songname: songs.value[i].name,
          artists: songs.value[i].artists,
          audioshow: false,
          audios: []
        }
        modal.value.desc = '加载中···'
        fetch(`/api/getAlbum/${songs.value[i].trueid}`).then(r => r.json())
            .then(r => {
              modal.value = {
                cover: songs.value[i].cover,
                songname: songs.value[i].name,
                artists: songs.value[i].artists,
                audioshow: false,
                audios: []
              }
              temp.value = (r.resourceState == true) ? r : {}
              modal.value.desc = (r.resourceState == true) ? r.album.description : '__//\n获取失败，请稍后再试···\n- Diary Music -\n//__'
              for (let i = 0; i < r.songs.length; i++) {
                modal.value.audioshow = true;
                let arts = []
                for (let iar = 0; iar < r.songs[i].ar.length; iar++) {
                  arts.push({
                    n: r.songs[i].ar[iar].name,
                    i: r.songs[i].ar[iar].id
                  })
                }
                modal.value.audios.push({
                  name: `#${i + 1}: ${r.songs[i].name}`,
                  artists: arts,
                  src: `/api/getMp3/${r.songs[i].id}`,
                })
              }
            })
            .catch(e =>
                modal.value.desc = `__//\n获取失败，请稍后再试···\n错误代码：${e}\n- Diary Music -\n//__`
            )
      }
      $('#PlayerModal').modal('show')
      curr.value = i
    }
  }
  onMounted(()=>{
    fetch('/api/get163', {
      headers: {
        'Content-Type': 'application/json;charset=utf8',
        'Access-Control-Allow-Origin': '*',
      }
    }).then(d => d.json())
        .then(d => {
          newsong.value = {
            name: '',
            cover: '',
            artists: {
              name: '',
              trueid: '',
            },
            desc: '',
            audioshow: false,
            audios: []
          }
              songs.value = (d.status = 200) ? ((d.data != undefined) ? d.data : {}) : {}
          temp.value = (d.status = 200) ? ((d.data != undefined) ? d.data : {}) : {}
          newsong.value = (d.status = 200) ? ((d.data != undefined) ? d.data[0] : {}) : {}
          newsong.value.desc = '加载中···'
          fetch(`/api/getAlbum/${songs.value[0].trueid}`).then(r => r.json())
              .then(r => {
                temp.value = (r.resourceState == true) ? r : {}
                newsong.value.desc = (r.resourceState == true) ? r.album.description : '__//\n获取失败，请稍后再试···\n- Diary Music -\n//__';
                newsong.value.audios = []
                for (let i = 0; i < r.songs.length; i++) {
                  newsong.value.audioshow = true;
                  let arts = []
                  for (let iar = 0; iar < r.songs[i].ar.length; iar++) {
                    arts.push({
                      n: r.songs[i].ar[iar].name,
                      i: r.songs[i].ar[iar].id
                    })
                  }
                  newsong.valuew.audios.push({
                    songname: `#${i + 1}: ${r.songs[0].name}`,
                    artists: arts,
                    src: `/api/getMp3/${r.songs[i].id}.mp3`,
                  })
                }
              })
              .catch(e => {
                newsong.value.desc = `__//\n获取失败，请稍后再试···\n错误代码：${e}\n- Diary Music -\n//__`
              })
        })
  })
</script>